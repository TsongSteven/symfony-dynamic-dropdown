{% extends "base.html.twig" %}
{% form_theme form _self 'admin/_mc_theme.html.twig' %}
{% block body %}
    <div class="container mt-3">
    {{ form_start(form) }}
        {{ form_row(form.mcs.vars.prototype.location,{'attr':{'class':'form-control'}}) }}
        <div class="mcs" data-index="{{ form.mcs|length > 0 ? form.mcs|last.vars.name + 1 : 0 }}"
   data-prototype="{{ include("admin/_mc_theme.html.twig", {form: form.mcs.vars.prototype})|e("html_attr") }}"> 
            {% for mc in form.mcs %}
                {{ include('admin/_mc_theme.html.twig', {form: mc}) }}
            {% endfor %}
        </div>
        <div class="flex-fill bd-highlight">
            <button type="submit" class="btn btn-danger text-white save-btn"><i class="fa-solid fa-floppy-disk"></i> Save Items</button>  
        </div>  
    {{ form_end(form) }}
    </div>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
       <script>

        var $addItemBtn = $('<a href="#" class="btn btn-primary btn-sm mt-2 mb-2">+ Add Item</a>');
        var $newLinkLi = $('<div></div>').append($addItemBtn);

        jQuery(document).ready(function() {
            var $collectionHolder = $('div.mcs');
            $collectionHolder.append($newLinkLi);
            $collectionHolder.data('index', $collectionHolder.find(':input').length);

            $addItemBtn.trigger('click');
            addItemForm($collectionHolder, $newLinkLi);
            $addItemBtn.on('click', function(e) {
                e.preventDefault();
                addItemForm($collectionHolder, $newLinkLi);
            });
        });

    function addItemForm($collectionHolder, $newLinkLi) {
        var prototype = $collectionHolder.data('prototype');
        var index = $collectionHolder.data('index');
        var newForm = prototype.replace(/__name__/g, index);
        $collectionHolder.data('index', index + 1);
        var $wrapper = $('<div class="mt-2"></div>');
        var $newFormLi = $('<div></div>').append(newForm);
        $wrapper.append($newFormLi);
        $newLinkLi.before($wrapper);
        
        $(document).on('click', '.remove-btn', function(e) {
                    e.preventDefault();
                    
                    var $formWrapper = $(this).closest('.mt-2');
            
                    if ($collectionHolder.children('.mt-2').length > 1) {
                        $formWrapper.remove();
                    }                    
                });
        }

    </script>
{% endblock %}